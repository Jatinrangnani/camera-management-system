<!DOCTYPE html>
<html>

<head>

<title>Admin Dashboard</title>

<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>

body{
background:#f4f6f9;
font-family:Segoe UI;
}

.sidebar{
height:100vh;
background:#212529;
color:white;
position:fixed;
width:230px;
}

.sidebar h4{
font-weight:600;
}

.sidebar a{
color:white;
text-decoration:none;
display:block;
padding:15px;
font-weight:500;
transition:0.3s;
}

.sidebar a:hover{
background:#0d6efd;
}

.main{
margin-left:230px;
padding:25px;
}

.card{
border-radius:12px;
box-shadow:0 2px 10px rgba(0,0,0,0.1);
border:none;
}

.table td{
vertical-align:middle;
}

video{
border-radius:10px;
margin-top:10px;
background:black;
width:100%;
height:200px;
object-fit:cover;
}

.section{
display:none;
}

</style>

</head>

<body>


<!-- SIDEBAR -->

<div class="sidebar">

<h4 class="text-center mt-3">Camera System</h4>

<a href="#" onclick="showSection('dashboard')">Dashboard</a>

<a href="#" onclick="showSection('cameras')">Cameras</a>

<a href="#" onclick="showSection('recordings')">Recordings</a>

<a href="#" onclick="showSection('users')">Users</a>

<a href="#" onclick="logout()">Logout</a>

</div>



<!-- MAIN CONTENT -->

<div class="main">

<h2>Admin Dashboard</h2>


<!-- DASHBOARD SECTION -->

<div id="dashboardSection" class="section">

<div class="row mt-4">

<div class="col-md-3">
<div class="card p-3">
<h6>Total Cameras</h6>
<h3 id="totalCameras">0</h3>
</div>
</div>

<div class="col-md-3">
<div class="card p-3">
<h6>Total Recordings</h6>
<h3 id="totalRecordings">0</h3>
</div>
</div>

</div>


<!-- MULTI CAMERA LIVE GRID -->

<div class="card p-3 mt-4">

<h4>All Cameras Live Preview</h4>

<div class="row" id="cameraGrid">

<!-- Cameras will be loaded dynamically here -->

</div>

</div>

</div>



<!-- CAMERAS SECTION -->

<div id="camerasSection" class="section mt-4">

<div class="card p-3">

<h5>Add Camera</h5>

<input id="cameraName" class="form-control mb-2" placeholder="Camera Name">

<input id="cameraLocation" class="form-control mb-2" placeholder="Location">

<input id="cameraSource" class="form-control mb-2" placeholder="Source (webcam / rtsp / url)">

<button class="btn btn-primary" onclick="addCamera()">
Add Camera
</button>

</div>



<div class="card mt-4 p-3">

<h5>Camera List</h5>

<table class="table table-striped">

<thead>

<tr>
<th>ID</th>
<th>Name</th>
<th>Controls</th>
<th>Delete</th>
</tr>

</thead>

<tbody id="cameraTable"></tbody>

</table>

</div>

</div>



<!-- RECORDINGS SECTION -->

<div id="recordingsSection" class="section mt-4">

<div class="card p-3">

<h5>Recordings</h5>

<table class="table table-striped">

<thead>

<tr>
<th>ID</th>
<th>Camera</th>
<th>Play</th>
<th>Delete</th>
</tr>

</thead>

<tbody id="recordingTable"></tbody>

</table>

</div>



<div class="card mt-4 p-3">

<h5>Video Player</h5>

<video id="player" controls></video>

</div>

</div>



<!-- USERS SECTION -->

<div id="usersSection" class="section mt-4">

<div class="card p-3">

<h5>Create User</h5>

<div class="row">

<div class="col">
<input id="newUsername" class="form-control" placeholder="Username">
</div>

<div class="col">
<input id="newPassword" type="password" class="form-control" placeholder="Password">
</div>

<div class="col">
<select id="newRole" class="form-control">
<option value="user">User</option>
<option value="admin">Admin</option>
</select>
</div>

<div class="col">
<button onclick="createUser()" class="btn btn-success w-100">
Create User
</button>
</div>

</div>

</div>



<div class="card mt-4 p-3">

<h5>User List</h5>

<table class="table table-striped">

<thead>

<tr>
<th>ID</th>
<th>Username</th>
<th>Role</th>
<th>Delete</th>
</tr>

</thead>

<tbody id="usersTable"></tbody>

</table>

</div>

</div>


</div>



<!-- SCRIPT -->

<script>


function showSection(section)
{

document.getElementById("dashboardSection").style.display="none";
document.getElementById("camerasSection").style.display="none";
document.getElementById("recordingsSection").style.display="none";
document.getElementById("usersSection").style.display="none";


if(section==="dashboard")
{
document.getElementById("dashboardSection").style.display="block";

loadCameraGrid();
}


if(section==="cameras")
document.getElementById("camerasSection").style.display="block";


if(section==="recordings")
document.getElementById("recordingsSection").style.display="block";


if(section==="users")
document.getElementById("usersSection").style.display="block";

}



// LOAD CAMERA GRID

async function loadCameraGrid()
{

const API = "http://127.0.0.1:8000";

const res = await fetch(API + "/cameras");

const cameras = await res.json();

const grid = document.getElementById("cameraGrid");

grid.innerHTML = "";


cameras.forEach(camera => {

const col = document.createElement("div");

col.className = "col-md-4";

col.innerHTML = `

<div class="card p-2 mb-3">

<h6>${camera.name}</h6>

<video id="cam_${camera.id}" autoplay muted></video>

<button class="btn btn-sm btn-success mt-2"
onclick="startCamera(${camera.id})">

Start Live

</button>

<button class="btn btn-sm btn-danger mt-2"
onclick="stopCamera(${camera.id})">

Stop

</button>

</div>

`;

grid.appendChild(col);

});

}



// STREAM STORAGE

let streams = {};


// START CAMERA

async function startCamera(id)
{

try{

const stream = await navigator.mediaDevices.getUserMedia({
video:true,
audio:false
});

document.getElementById("cam_"+id).srcObject = stream;

streams[id] = stream;

}catch(e){

alert("Camera access denied");

}

}



// STOP CAMERA

function stopCamera(id)
{

if(streams[id])
{
streams[id].getTracks().forEach(track=>track.stop());

document.getElementById("cam_"+id).srcObject = null;

delete streams[id];
}

}



// SHOW DASHBOARD FIRST

showSection("dashboard");


</script>



<script src="js/admin.js"></script>


</body>
</html>
